<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-bounce.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"odddog-git.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="MongoDB是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。他支持的数据结构非常松散，是类似json的bson格式，因此可以存储比较复杂的数据类型。">
<meta property="og:type" content="article">
<meta property="og:title" content="mongoDB">
<meta property="og:url" content="http://odddog-git.github.io/2022/01/19/mongoDB/index.html">
<meta property="og:site_name" content="hui&#39;s Blog">
<meta property="og:description" content="MongoDB是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。他支持的数据结构非常松散，是类似json的bson格式，因此可以存储比较复杂的数据类型。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s4.ax1x.com/2022/01/20/7ygDyt.png">
<meta property="article:published_time" content="2022-01-19T07:49:48.000Z">
<meta property="article:modified_time" content="2022-01-20T06:25:14.543Z">
<meta property="article:author" content="怪狗狗">
<meta property="article:tag" content="noSQL">
<meta property="article:tag" content="mongoDB">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s4.ax1x.com/2022/01/20/7ygDyt.png">

<link rel="canonical" href="http://odddog-git.github.io/2022/01/19/mongoDB/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>mongoDB | hui's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
  <a target="_blank" rel="noopener" href="https://oddDog-git" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">hui's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://odddog-git.github.io/2022/01/19/mongoDB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/jerry.jpg">
      <meta itemprop="name" content="怪狗狗">
      <meta itemprop="description" content="跑得又快，长得又帅">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hui's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          mongoDB
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-19 15:49:48" itemprop="dateCreated datePublished" datetime="2022-01-19T15:49:48+08:00">2022-01-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-20 14:25:14" itemprop="dateModified" datetime="2022-01-20T14:25:14+08:00">2022-01-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/01/19/mongoDB/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/01/19/mongoDB/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>MongoDB是一个介于<code>关系数据库</code>和<code>非关系数据库</code>之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。<strong>他支持的数据结构非常松散，是类似json的bson格式，因此可以存储比较复杂的数据类型</strong>。<a id="more"></a></p>
<p><strong>应用场景</strong></p>
<ul>
<li>游戏场景，使用 MongoDB 存储游戏用户信息，用户的装备、 积分等直接以内嵌文档的形式存储，方便查询、更新 </li>
<li>物流场景，使用 MongoDB 存储订单信息，订单状态在运送过 程中会不断更新，以 MongoDB 内嵌数组的形式来存储，一次 查询就能将订单所有的变更读取出来。 </li>
<li>社交场景，使用 MongoDB 存储存储用户信息，以及用户发表 的朋友圈信息，通过地理位置索引实现附近的人、地点等功能 </li>
<li>物联网场景，使用 MongoDB 存储所有接入的智能设备信息， 以及设备汇报的日志信息，并对这些信息进行多维度的分析 </li>
<li>视频直播，使用 MongoDB 存储用户信息、礼物信息等</li>
</ul>
<p><strong>优点</strong></p>
<ul>
<li> 弱一致性（最终一致），更能保证用户的访问速度</li>
<li>文档结构的存储方式，能够更便捷的获 取数据</li>
<li>内置GridFS，支持大容量的存储<ul>
<li>GridFS是一个出色的分布式文件系统，可以支持海量的数据存 储。 </li>
<li>内置了GridFS了MongoDB，能够满足对大数据集的快速范围查 询。</li>
</ul>
</li>
<li>内置Sharding</li>
<li>第三方支持丰富</li>
</ul>
<p><strong>缺点</strong></p>
<ul>
<li>事务支持不友好</li>
<li>占用空间过大<ul>
<li>空间的预分配：为避免形成过多的硬盘碎片，mongodb 每次空间不足时都会申请生成一大块的硬盘空间，而且申请 的量从64M、128M、256M那 样的指数递增，直到2G为单 个文件的最大体积。</li>
<li>删除记录不释放空间：这很容易理解，为避免记录删除 后的数据的大规模挪动，原记录空间不删除，只标记“已删 除”即可，以后还可以重复利用。</li>
<li>可以定期运行 <code>db.repairDatabase()</code>来整理记录，但这个 过程会比较缓慢</li>
</ul>
</li>
</ul>
<h1 id="安装与配置"><a href="#安装与配置" class="headerlink" title="安装与配置"></a>安装与配置</h1><p>官网： <a target="_blank" rel="noopener" href="http://www.mongodb.org/">www.mongodb.org</a>   , 这里下载的是 <code>mongodb-linux-x86_64-rhel70-4.2.18.tgz</code></p>
<ul>
<li>将压缩包上传到 linux 下的 /opt 目录，并解压</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf mongodb-linux-x86_64-rhel70-4.2.18.tgz</span><br></pre></td></tr></table></figure>
<ul>
<li>进入 mongoDB 目录中，创建配置文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vim mongo.conf</span><br><span class="line">## 文件内容如下</span><br><span class="line">dbpath&#x3D;&#x2F;data&#x2F;mongo&#x2F;     # 数据库目录，默认&#x2F;data&#x2F;db</span><br><span class="line">port&#x3D;27017				# 监听的端口，默认27017</span><br><span class="line">bind_ip&#x3D;0.0.0.0			# 监听IP地址，默认全部可以访问</span><br><span class="line">fork&#x3D;true				# 是否已后台启动的方式登入</span><br><span class="line">logpath&#x3D;&#x2F;data&#x2F;mongo&#x2F;MongoDB.log	 # 日志路径</span><br><span class="line">logappend&#x3D;true			# 是否追加日志</span><br><span class="line">auth&#x3D;false				# 是否开启用户密码登入</span><br></pre></td></tr></table></figure>
<ul>
<li>创建数据库目录  <code>dbpath=/data/mongo/</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p &#x2F;data&#x2F;mongo&#x2F;</span><br></pre></td></tr></table></figure>
<p><strong>启动，指定配置文件</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;bin&#x2F;mongod -f mongo.conf</span><br></pre></td></tr></table></figure>
<p><strong>进入mongo，可指定ip与端口</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;bin&#x2F;mongo (--host&#x3D;主机IP --prot&#x3D;端口)</span><br></pre></td></tr></table></figure>
<p>(这里使用的GUI工具是 NoSQLBooster，可取官网自行下载)</p>
<h1 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h1><ul>
<li>查看数据库</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show dbs;</span><br></pre></td></tr></table></figure>
<ul>
<li>切换数据库 (如果没有则新增，新数据库要插入了一个文档后才显示)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use 数据库名;</span><br></pre></td></tr></table></figure>
<ul>
<li>删除数据库</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.dropDatabase();</span><br></pre></td></tr></table></figure>
<ul>
<li>创建集合 (相当于表)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.createCollection(&quot;集合名&quot;);</span><br></pre></td></tr></table></figure>
<ul>
<li>查看集合</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show tables;</span><br><span class="line">show collections;</span><br></pre></td></tr></table></figure>
<ul>
<li>删除集合</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.集合名.drop();</span><br></pre></td></tr></table></figure>
<h2 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h2><p>插入一条数据，dept集合如果没有会自动创建（数据为json格式）</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">db.dept.insert(</span><br><span class="line">   &#123;</span><br><span class="line">       <span class="attr">&quot;did&quot;</span>:<span class="number">1</span>,</span><br><span class="line">       <span class="attr">&quot;dname&quot;</span>:<span class="string">&quot;开发部&quot;</span>,</span><br><span class="line">       <span class="attr">&quot;loc&quot;</span>:<span class="string">&quot;A区1座&quot;</span></span><br><span class="line">   &#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var dataVar = &#123;</span><br><span class="line">     &quot;did&quot;:2,</span><br><span class="line">     &quot;dname&quot;:&quot;市场部&quot;,</span><br><span class="line">     &quot;loc&quot;:&quot;深圳&quot;,</span><br><span class="line">     &quot;count&quot;:20</span><br><span class="line">&#125;</span><br><span class="line">db.dept.insert(dataVar);</span><br></pre></td></tr></table></figure>
<p>插入多条数据</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for(var i = 1; i&lt;100;i++)&#123;</span><br><span class="line"> db.dept.insert(&#123;&quot;did&quot;:i,&quot;dname&quot;:&quot;测试&quot;+i+&quot;部&quot;&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>MondoDB中的每一条数据都有 <code>_id</code>字段，该字段是由 <strong>时间戳+机器码+进程的pid+计数器</strong> 组成的,绝对不会重复</p>
<h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><p>remove( ) 有两个可选项 </p>
<ul>
<li>满足条件的删除 </li>
<li>是否只删除一条，默认 false</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.dept.remove(&#123;</span><br><span class="line">     &quot;_id&quot; : ObjectId(&quot;6114d0d2430f6b4dcc876c41&quot;)</span><br><span class="line">&#125;,true);</span><br></pre></td></tr></table></figure>
<p>删除名称中含有 “测试”的数据</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.dept.remove(&#123;</span><br><span class="line">	&quot;dname&quot;: /测试/</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>清空集合</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.dept.remove(&#123;&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h2><p>对于Mongo而言,最好的办法不是修 改,而是删掉,重新添加.</p>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><p>update(更新条件, 新对象数据, upsert , multi)</p>
<ul>
<li>upsert  : 数据没有时是否执行新增操作</li>
<li>multi : 是否匹配多个结果</li>
</ul>
<p>根据id执行简单的修改 </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var newData=&#123;</span><br><span class="line">     &quot;id&quot;:1,</span><br><span class="line">     &quot;name&quot;:&quot;吕布&quot;,</span><br><span class="line">     &quot;age&quot;:29	</span><br><span class="line">&#125;</span><br><span class="line">db.dept.update(&#123;</span><br><span class="line"> 	&quot;_id&quot;: ObjectId(&quot;6114df1d430f6b4dcc876c42&quot;),</span><br><span class="line">&#125;, newData);</span><br></pre></td></tr></table></figure>
<h3 id="修改器"><a href="#修改器" class="headerlink" title="修改器"></a>修改器</h3><p>初始化一条数据</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.student.insert(&#123;</span><br><span class="line">    &quot;name&quot;:&quot;王二麻子&quot;,</span><br><span class="line">    &quot;age&quot;:88,</span><br><span class="line">    &quot;score&quot;:99</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li><font color="red">$inc</font> : 针对数字字段,增加某个数字字段的值</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 修改王二麻子的age+2，score-10</span></span><br><span class="line">db.student.update(&#123;&quot;name&quot;:&quot;王二麻子&quot;&#125;,&#123;</span><br><span class="line">	&quot;$inc&quot;:&#123;&quot;age&quot;:2,&quot;score&quot;:-10&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li><font color="red">$set</font> : 重新设定内容</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 修改王二麻子的名称</span></span><br><span class="line">db.student.update(&#123;&quot;name&quot;:&quot;王二麻子&quot;&#125;,&#123;</span><br><span class="line">	&quot;$set&quot;:&#123;&quot;name&quot;:&quot;张三&quot;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li><font color="red">$unset</font>：删除某个字段</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除&quot;score&quot;字段</span></span><br><span class="line">db.student.update(&#123;&quot;name&quot;:&quot;张三&quot;&#125;,&#123;</span><br><span class="line">	&quot;$unset&quot;:&#123;&quot;score&quot;:1&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li><font color="red">$push</font>：给字段追加内容（数组操作）</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 给subject字段添加一门科目</span></span><br><span class="line">db.student.update(&#123;&quot;name&quot;:&quot;张三&quot;&#125;,&#123;</span><br><span class="line">	&quot;$push&quot;:&#123;&quot;subject&quot;:&quot;语文&quot;&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li><font color="red">$pushAll</font>：追加数组，在高版本该修改其已淘汰，可使用 $push+$each</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加多门科目</span></span><br><span class="line">db.student.update(&#123;&quot;name&quot;:&quot;张三&quot;&#125;,&#123;</span><br><span class="line">	&quot;$push&quot;:&#123;&quot;subject&quot;:&#123;</span><br><span class="line">		&quot;$each&quot;:[&quot;语文&quot;,&quot;物理&quot;,&quot;化学&quot;,&quot;数学&quot;]</span><br><span class="line">    &#125;&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li><font color="red">$addToSet</font>：追加内容到数组，如果存在就不新增</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加一门科目，如果已存在就不添加</span></span><br><span class="line">db.student.update(&#123;&quot;name&quot;:&quot;张三&quot;&#125;,&#123;</span><br><span class="line">	&quot;$addToSet&quot;:&#123;&quot;subject&quot;:&quot;物理&quot;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li><font color="red">$pop</font>: 删除数组中的内容</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除第一门科目</span></span><br><span class="line">db.student.update(&#123;&quot;name&quot;:&quot;张三&quot;&#125;,&#123;</span><br><span class="line">	&quot;$pop&quot;:&#123;&quot;subject&quot;:-1&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 删除最后一门科目</span></span><br><span class="line">db.student.update(&#123;&quot;name&quot;:&quot;张三&quot;&#125;,&#123;</span><br><span class="line">	&quot;$pop&quot;:&#123;&quot;subject&quot;:1&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li><font color="red">$pull </font>:  删除数组中指定的内容, 不存在则没变化</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 删除语文课</span><br><span class="line">db.student.update(&#123;&quot;name&quot;:&quot;张三&quot;&#125;,&#123;</span><br><span class="line">	&quot;$pull&quot;:&#123;&quot;subject&quot;:&quot;语文&quot;&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li><font color="red">$pullAll</font>: 删除数组中多个内容</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除多门课</span></span><br><span class="line">db.student.update(&#123;&quot;name&quot;:&quot;张三&quot;&#125;,&#123;</span><br><span class="line">	&quot;$pullAll&quot;:&#123;&quot;subject&quot;:[&quot;物理&quot;,&quot;数学&quot;]&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li><font color="red">$rename</font>: 字段重命名</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将&quot;subject&quot;重命名为&quot;学科&quot;</span></span><br><span class="line">db.student.update(&#123;&quot;name&quot;:&quot;张三&quot;&#125;,&#123;</span><br><span class="line">	&quot;$rename&quot;:&#123;&quot;subject&quot;:&quot;学科&quot;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h2><p>普通查询 <strong>db.集合名.find({查询条件})</strong> </p>
<p>投影查询 <strong>db.集合名.find( {查询条件} , {控制字段的显示})</strong></p>
<p>查询一条 <strong>db.集合名.findOne()</strong></p>
<p>0不显示  , 1显示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 查询did为1,并只显示dname与address字段(要么全为1或全为0)</span><br><span class="line">db.dept.find(</span><br><span class="line">   &#123;&quot;did&quot;:1&#125;,</span><br><span class="line">   &#123;&quot;dname&quot;:1,&quot;address&quot;:1&#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="关系运算"><a href="#关系运算" class="headerlink" title="关系运算"></a>关系运算</h3><table>
<thead>
<tr>
<th>操作</th>
<th>条件</th>
</tr>
</thead>
<tbody><tr>
<td>等于</td>
<td>{key:{“<strong>$eq</strong>“:value}}  或   {key:value}</td>
</tr>
<tr>
<td>大于</td>
<td>{key:{“<strong>$gt</strong>“:value}}</td>
</tr>
<tr>
<td>小于</td>
<td>{key:{“<strong>$lt</strong>“:value}}</td>
</tr>
<tr>
<td>大于等于</td>
<td>{key:{“<strong>$gte</strong>“:value}}</td>
</tr>
<tr>
<td>小于等于</td>
<td>{key:{“<strong>$lte</strong>“:value}}</td>
</tr>
<tr>
<td>不等于</td>
<td>{key:{“<strong>$ne</strong>“:value}}</td>
</tr>
</tbody></table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 查询18岁以上的同学</span><br><span class="line">db.student.find(&#123;</span><br><span class="line">	&quot;age&quot;:&#123;&quot;$gt&quot;:18&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#x2F;&#x2F; 查询18岁以上的女同学(与关系)</span><br><span class="line">db.student.find(&#123;</span><br><span class="line">	&quot;age&quot;:&#123;&quot;$gt&quot;:18&#125;,</span><br><span class="line">	&quot;sex&quot;:&quot;女&quot;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="逻辑运算"><a href="#逻辑运算" class="headerlink" title="逻辑运算"></a>逻辑运算</h3><p>与 <strong>$and</strong></p>
<p>或  <strong>$or</strong></p>
<p>非  <strong>$not/$nor</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 查询年龄在18-20之间的同学(与关系)</span><br><span class="line">db.student.find(&#123;</span><br><span class="line">	&quot;age&quot;:&#123;</span><br><span class="line">		&quot;$gt&quot;:18,</span><br><span class="line">		&quot;$lt&quot;:20</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 18岁以上,或者性别是女的同学(或关系)</span><br><span class="line">db.stuent.find(&#123;</span><br><span class="line">	&quot;$or&quot;:[</span><br><span class="line">		&#123;&quot;age&quot;:&#123;&quot;$gt&quot;:18&#125;&#125;,</span><br><span class="line">		&#123;&quot;sex&quot;:&quot;女&quot;&#125;</span><br><span class="line">	]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 22岁以下,性别是男的同学(使用&quot;$nor&quot;取反操作)</span><br><span class="line">db.stuent.find(&#123;</span><br><span class="line">	&quot;$nor&quot;:[</span><br><span class="line">		&#123;&quot;age&quot;:&#123;&quot;$gte&quot;:22&#125;&#125;,</span><br><span class="line">		&#123;&quot;sex&quot;:&quot;女&quot;&#125;</span><br><span class="line">	]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="求模"><a href="#求模" class="headerlink" title="求模"></a>求模</h3><p>求余数   <strong>{key:{“$mod”:[x,y]}}</strong>  , 表示获取满足  key% x == y 的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 获取年龄为奇数的同学</span><br><span class="line">db.student.find(&#123;</span><br><span class="line">	&quot;age&quot;:&#123;&quot;$mod&quot;:[2,1]&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="范围"><a href="#范围" class="headerlink" title="范围"></a>范围</h3><p><strong>$in</strong> 在范围内</p>
<p><strong>$nin</strong>  不在范围内</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 查询 张三,李四,王五</span><br><span class="line">db.student.find(&#123;</span><br><span class="line">	&quot;name&quot;:&#123;&quot;$in&quot;:[&quot;张三&quot;,&quot;李四&quot;,&quot;王五&quot;]&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="数组查询"><a href="#数组查询" class="headerlink" title="数组查询"></a>数组查询</h3><p>初始化一些数据</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.student.insert(&#123;&quot;name&quot;:&quot;辉-A&quot;,&quot;address&quot;:&quot;中关村1&quot;,&quot;subject&quot;:[&quot;语文&quot;,&quot;数学&quot;,&quot;英语&quot;]&#125;);</span><br><span class="line">db.student.insert(&#123;&quot;name&quot;:&quot;辉-B&quot;,&quot;address&quot;:&quot;中关村2&quot;,&quot;subject&quot;:[&quot;语文&quot;,&quot;数学&quot;,&quot;英语&quot;,&quot;物理&quot;]&#125;);</span><br><span class="line">db.student.insert(&#123;&quot;name&quot;:&quot;辉-C&quot;,&quot;address&quot;:&quot;中关村3&quot;,&quot;subject&quot;:[&quot;语文&quot;,&quot;数学&quot;,&quot;英语&quot;,&quot;物理&quot;,&quot;化学&quot;]&#125;);</span><br><span class="line">db.student.insert(&#123;&quot;name&quot;:&quot;辉-D&quot;,&quot;address&quot;:&quot;中关村4&quot;,&quot;subject&quot;:[&quot;物理&quot;,&quot;化学&quot;]&#125;);</span><br><span class="line">db.student.insert(&#123;&quot;name&quot;:&quot;辉-E&quot;,&quot;address&quot;:&quot;中关村5&quot;,&quot;subject&quot;:[&quot;语文&quot;,&quot;数学&quot;,&quot;化学&quot;]&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>$all</strong>   并查询数组</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 查询同时有 语文 和 数学 课程的同学</span><br><span class="line">db.student.find(&#123;</span><br><span class="line">    &quot;subject&quot; : &#123;</span><br><span class="line">        &quot;$all&quot; : [&quot;语文&quot;,&quot;数学&quot;]</span><br><span class="line">   &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>key.index</strong> 查询数组中指定下标内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 查询第一门课为数学的学生</span><br><span class="line">db.student.find(&#123;</span><br><span class="line">    &quot;subject.0&quot; : &quot;数学&quot;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>$size</strong>  数组长度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 查询只有两门课的学生</span><br><span class="line">db.student.find(&#123;</span><br><span class="line">    &quot;subject&quot; : &#123;</span><br><span class="line">    	&quot;$size&quot;:2</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>$slice</strong>  投影查询,只返回数组中指定的内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 查询年龄为19,只返回前两门课</span><br><span class="line">db.student.find(</span><br><span class="line">	&#123;&quot;age&quot;:19&#125;,</span><br><span class="line">	&#123;&quot;subject&quot;:&#123;</span><br><span class="line">		&quot;$slice&quot;:2</span><br><span class="line">	&#125;&#125;</span><br><span class="line">)</span><br><span class="line">&#x2F;&#x2F; 返回后两节课</span><br><span class="line">&quot;$slice&quot;:-2</span><br><span class="line">&#x2F;&#x2F; 返回从索引1开始,获取两节课</span><br><span class="line">&quot;$slice&quot;:[1,2]</span><br></pre></td></tr></table></figure>
<h3 id="嵌套集合"><a href="#嵌套集合" class="headerlink" title="嵌套集合"></a>嵌套集合</h3><p>初始化数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">db.student.insert(&#123;</span><br><span class="line">    &quot;name&quot;:&quot;辉&quot;,</span><br><span class="line">    &quot;age&quot;:21,</span><br><span class="line">    &quot;pets&quot;:[</span><br><span class="line">       &#123;</span><br><span class="line">            &quot;name&quot;:&quot;旺财&quot;,</span><br><span class="line">            &quot;age&quot;:3,</span><br><span class="line">            &quot;brand&quot;:&quot;狗&quot;</span><br><span class="line">       &#125;,</span><br><span class="line">       &#123;</span><br><span class="line">            &quot;name&quot;:&quot;tom&quot;,</span><br><span class="line">            &quot;age&quot;:4,</span><br><span class="line">            &quot;brand&quot;:&quot;猫&quot;</span><br><span class="line">       &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;);  </span><br></pre></td></tr></table></figure>
<p><strong>$elemMatch</strong> 遍历数组中的每一条数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 查询20以上并养猫的人</span><br><span class="line">db.student.find(&#123;</span><br><span class="line">	&quot;age&quot;:&#123;&quot;$gt&quot;:20&#125;,</span><br><span class="line">	&quot;pets&quot;:&#123;</span><br><span class="line">		&quot;$elemMatch&quot;:&#123;</span><br><span class="line">			&quot;brand&quot;:&quot;猫&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="字段是否存在"><a href="#字段是否存在" class="headerlink" title="字段是否存在"></a>字段是否存在</h3><p><strong>$exists</strong>  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 查询有宠物的人</span><br><span class="line">db.student.find(&#123;</span><br><span class="line">    &quot;pets&quot;:&#123;</span><br><span class="line">        &quot;$exists&quot; : true</span><br><span class="line">   &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="模糊查询"><a href="#模糊查询" class="headerlink" title="模糊查询"></a>模糊查询</h3><p>想模糊查询,必须使用正则</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询名字包含辉的同学</span></span><br><span class="line">db.student.find(&#123;</span><br><span class="line">    &quot;name&quot; : &#123;</span><br><span class="line">        &quot;$regex&quot; : /辉/</span><br><span class="line">   &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 上面写法中$regex可省略</span></span><br><span class="line">db.student.find(&#123;</span><br><span class="line">    &quot;name&quot; : /辉/</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 查询姓名中包含a的,可加i,忽略大小写</span></span><br><span class="line">db.student.find(&#123;</span><br><span class="line">    &quot;name&quot; : /a/i</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>以上模糊查询对数组也生效</p>
<h3 id="分页与排序"><a href="#分页与排序" class="headerlink" title="分页与排序"></a>分页与排序</h3><p><strong>skip(n)</strong>  跳过多少行 <code>(pageNum-1)*pageSize</code></p>
<p><strong>limit(n)</strong>  获取多少行数据</p>
<p><strong>sort({})</strong>   排序,1为升序,-1为降序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 获取第一页数据,每页显示10条数据,却年龄升序</span><br><span class="line">db.student.find().skip(0).limit(10).sort(&#123;</span><br><span class="line">	&quot;age&quot;:1</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="条件过滤where"><a href="#条件过滤where" class="headerlink" title="条件过滤where"></a>条件过滤where</h3><ul>
<li>查询年龄40岁以上的学生</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.student.find(&#123;</span><br><span class="line">    &quot;$where&quot;:&quot;this.age &gt; 40&quot;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>缺点</strong>   将MongoDB中的BSON数据转成了Javascript 语法结构循环验证</p>
<p>不方便使用数据库的索引机制.并不推荐使用,只需知道有这种查询方式即可</p>
<h2 id="游标"><a href="#游标" class="headerlink" title="游标"></a>游标</h2><p>游标就是让数据一行行的执行，类似与java中的foreach循环</p>
<p>使用 find() 函数可返回游标，然后使用游标的两个函数 <code>hasNext()</code> 、<code>next()</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var you = db.student.find();</span><br><span class="line">while(you.hasNext())&#123;</span><br><span class="line">    print(you.next().name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h1><p>索引能够加快搜索性能,索引分两种: 自动创建的 和 手动创建的</p>
<p><strong>查看集合中索引</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.student.getIndexes();</span><br></pre></td></tr></table></figure>
<p>_id_  为自动创建的索引</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/7ygDyt"><img src="https://s4.ax1x.com/2022/01/20/7ygDyt.png" alt="7ygDyt.png"></a></p>
<p><strong>创建索引</strong></p>
<p><code>db.集合名.ensureIndex()</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;为age创建一个降序索引</span><br><span class="line">db.student.ensureIndex(&#123;</span><br><span class="line">	&quot;age&quot;:-1</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>删除索引</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 删除刚刚创建的索引</span><br><span class="line">db.student.dropIndex(&#123;</span><br><span class="line">	&quot;age&quot;:-1</span><br><span class="line">&#125;);</span><br><span class="line">&#x2F;&#x2F; 删除全部索引,默认索引不能删除</span><br><span class="line">db.student.dropIndexes();</span><br></pre></td></tr></table></figure>
<h2 id="唯一索引"><a href="#唯一索引" class="headerlink" title="唯一索引"></a>唯一索引</h2><p>用在有一个字段,让该字段的内容不能重复</p>
<ul>
<li>给name字段加上唯一索引,如果添加重复的值,会报错</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.student.ensureIndex(</span><br><span class="line">	&#123;&quot;name&quot;,1&#125;,</span><br><span class="line">	&#123;&quot;unique&quot;:true&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="过期索引"><a href="#过期索引" class="headerlink" title="过期索引"></a>过期索引</h2><p>程序会出现若干秒之后，信息删除,这个间隔时间大多数情况下并不准确</p>
<p>删除过程是由后台程序每60s跑一次，而且删除也需要一些 时间，存在误差</p>
<ul>
<li>添加一个10s的过期索引</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.phones.ensureIndex(</span><br><span class="line">	&#123;&quot;time&quot;,1&#125;,</span><br><span class="line">	&#123;&quot;expireAfterSeconds&quot;:10&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>添加数据</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.phones.insert(&#123;&quot;num&quot;:110,&quot;time&quot;: ISODate(&quot;2020-01-01T22:55:13.369Z&quot;)&#125;);</span><br></pre></td></tr></table></figure>
<p>过期索引中最好的时间类型是<strong>ISODate</strong>（0时区的时间），0 时区到Date会有一定的换算程序，所以用Date删除的时间偏差更大</p>
<h2 id="全文索引"><a href="#全文索引" class="headerlink" title="全文索引"></a>全文索引</h2><p>模糊查询只能根据某个字段进行查询,而全文查询能查询整个集合.</p>
<ul>
<li>初始化一些数据</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.news.insert(&#123;&quot;title&quot;:&quot;NoSQL&quot;,&quot;context&quot;:&quot;MongoDB&quot;&#125;);</span><br><span class="line">db.news.insert(&#123;&quot;title&quot;:&quot;js java&quot;,&quot;context&quot;:&quot;前端技术&quot;&#125;);</span><br><span class="line">db.news.insert(&#123;&quot;title&quot;:&quot;编程语言&quot;,&quot;context&quot;:&quot;java&quot;&#125;);</span><br><span class="line">db.news.insert(&#123;&quot;title&quot;:&quot;java&quot;,&quot;context&quot;:&quot;好语言&quot;&#125;);</span><br><span class="line">db.news.insert(&#123;&quot;title&quot;:&quot;java&quot;,&quot;context&quot;:&quot;java&quot;&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>设置全文索引</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">db.news.ensureIndex(&#123;</span><br><span class="line">   &quot;title&quot;:&quot;text&quot;,</span><br><span class="line">   &quot;context&quot;:&quot;text&quot;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 可给所有字段添加全文索引</span></span><br><span class="line">db.news.ensureIndex(&#123;</span><br><span class="line">    &quot;$**&quot;:&quot;text&quot;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>全文搜索</strong></p>
<p>使用 <code>$text</code> 与 <code>$search</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.news.find(&#123;</span><br><span class="line">	&quot;$text&quot;:&#123;</span><br><span class="line">		&quot;$search&quot;:&quot;java&quot;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>查询多个关键字(或关系)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;$search&quot;:&quot;关键字1 关键字2&quot;&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>查询多个关键字(且关系)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;$search&quot;:&quot; \&quot;关键字1\&quot; \&quot;关键字2\&quot; &quot;&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>查询多个关键字(差关系)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;$search&quot;:&quot;关键字1 -关键字2&quot;&#125;  &#x2F;&#x2F; 存在关键字1且不存在关键字2</span><br></pre></td></tr></table></figure>
<h2 id="地理信息索引"><a href="#地理信息索引" class="headerlink" title="地理信息索引"></a>地理信息索引</h2><p>2DSphere(球面索引) :  摇一摇，大众点评，美团都是基于2D索引的，保存的信息都是坐标，坐标都是经纬度.</p>
<ul>
<li>初始化一些数据</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">db.shops.insert(&#123;&#x27;loc&#x27;:[10,10]&#125;);</span><br><span class="line">db.shops.insert(&#123;&#x27;loc&#x27;:[11,11]&#125;);</span><br><span class="line">db.shops.insert(&#123;&#x27;loc&#x27;:[13,12]&#125;);</span><br><span class="line">db.shops.insert(&#123;&#x27;loc&#x27;:[50,14]&#125;);</span><br><span class="line">db.shops.insert(&#123;&#x27;loc&#x27;:[66,66]&#125;);</span><br><span class="line">db.shops.insert(&#123;&#x27;loc&#x27;:[110,119]&#125;);</span><br><span class="line">db.shops.insert(&#123;&#x27;loc&#x27;:[93,24]&#125;);</span><br><span class="line">db.shops.insert(&#123;&#x27;loc&#x27;:[99,54]&#125;);</span><br><span class="line">db.shops.insert(&#123;&#x27;loc&#x27;:[77,7]&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>创建2D索引</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.shops.ensureIndex(&#123;</span><br><span class="line">	&quot;loc&quot;:&quot;2d&quot;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>坐标查询</strong></p>
<ul>
<li>$near : 查询距离某个点距离最近的坐标点;</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询[11,11]坐标点附件的点,可设置查询范围</span></span><br><span class="line">db.shops.find(&#123;</span><br><span class="line">	&quot;loc&quot;:&#123;</span><br><span class="line">		&quot;$near&quot;:[11,11],</span><br><span class="line">		&quot;$maxDistance&quot;:5</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>$geoWithin : 查询某个形状内的坐标点;<ul>
<li>矩形范围 $box</li>
<li>圆形范围 $center</li>
<li>多边形范围 $polygon</li>
</ul>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 矩形范围</span></span><br><span class="line">db.shops.find(&#123;</span><br><span class="line">	&quot;loc&quot;:&#123;</span><br><span class="line">		&quot;$genWithin&quot;:&#123;</span><br><span class="line">			&quot;$box&quot;:[[9,9],[11,11]]</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 圆形范围</span></span><br><span class="line">db.shops.find(&#123;</span><br><span class="line">	&quot;loc&quot;:&#123;</span><br><span class="line">		&quot;$genWithin&quot;:&#123;</span><br><span class="line">			&quot;$center&quot;:[[9,9],3] 			</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 多边形范围, 如下是三角形</span></span><br><span class="line">db.shops.find(&#123;</span><br><span class="line">	&quot;loc&quot;:&#123;</span><br><span class="line">		&quot;$genWithin&quot;:&#123;</span><br><span class="line">			&quot;$polygon&quot;:[[1,2],[2,5],[5,3]]</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="索引的限制"><a href="#索引的限制" class="headerlink" title="索引的限制"></a>索引的限制</h2><ol>
<li>如果MongoDB的索引项超过索引限制，即1024 bytes，将不会 创建该索引（创建失败），并且插入数据和更新数据会报错 </li>
<li>一个collections最多能够有64个索引</li>
<li>针对复合索引,包含的索引属性不能够超过31个属性 </li>
<li>查询不能够同时使用文本索引和地理空间索引(Queries cannot use both text and Geospatial Indexes) </li>
<li>包含2d 属性的索引，只能够针对地理空间属性</li>
</ol>
<h1 id="聚合"><a href="#聚合" class="headerlink" title="聚合"></a>聚合</h1><p>所谓的”聚合”,也就是”分组统计”</p>
<h2 id="数据量"><a href="#数据量" class="headerlink" title="数据量"></a>数据量</h2><ul>
<li>获取集合中的数据量</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.student.count();</span><br></pre></td></tr></table></figure>
<ul>
<li>获取查询后的数据量</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.student.count(&#123;&quot;name&quot;:/辉/&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="消除重复数据"><a href="#消除重复数据" class="headerlink" title="消除重复数据"></a>消除重复数据</h2><p>没有直接的函数支持.所以我们只能用,最原始的runCommand()</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询所有student,消除重复的name</span></span><br><span class="line">db.runCOmmand(&#123;</span><br><span class="line">	&quot;distinct&quot;:&quot;student&quot;,</span><br><span class="line">	&quot;key&quot;:&quot;name&quot;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="聚合框架"><a href="#聚合框架" class="headerlink" title="聚合框架"></a>聚合框架</h2><p>MongoDB中的MapReduce写起来的很复杂 , 所以在 Mongo2.x之后,提供了聚合框架.</p>
<p>函数 : <strong>aggregate()</strong></p>
<ul>
<li>初始化数据</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">db.emps.insert(&#123;&quot;name&quot;:&quot;张三&quot;,&quot;sex&quot;:&quot;男&quot;,&quot;age&quot;:19,&quot;job&quot;:&quot;程序猿&quot;,&quot;salary&quot;:5000&#125;);</span><br><span class="line">db.emps.insert(&#123;&quot;name&quot;:&quot;李四&quot;,&quot;sex&quot;:&quot;女&quot;,&quot;age&quot;:18,&quot;job&quot;:&quot;美工&quot;,&quot;salary&quot;:6000&#125;);</span><br><span class="line">db.emps.insert(&#123;&quot;name&quot;:&quot;王五&quot;,&quot;sex&quot;:&quot;女&quot;,&quot;age&quot;:21,&quot;job&quot;:&quot;测试&quot;,&quot;salary&quot;:7000&#125;);</span><br><span class="line">db.emps.insert(&#123;&quot;name&quot;:&quot;赵六&quot;,&quot;sex&quot;:&quot;女&quot;,&quot;age&quot;:21,&quot;job&quot;:&quot;程序猿&quot;,&quot;salary&quot;:5500&#125;);</span><br><span class="line">db.emps.insert(&#123;&quot;name&quot;:&quot;孙七&quot;,&quot;sex&quot;:&quot;男&quot;,&quot;age&quot;:22,&quot;job&quot;:&quot;测试&quot;,&quot;salary&quot;:8000&#125;);</span><br><span class="line">db.emps.insert(&#123;&quot;name&quot;:&quot;田八&quot;,&quot;sex&quot;:&quot;女&quot;,&quot;age&quot;:22,&quot;job&quot;:&quot;程序猿&quot;,&quot;salary&quot;:3000&#125;);</span><br><span class="line">db.emps.insert(&#123;&quot;name&quot;:&quot;钱九&quot;,&quot;sex&quot;:&quot;男&quot;,&quot;age&quot;:23,&quot;job&quot;:&quot;美工&quot;,&quot;salary&quot;:4500&#125;);</span><br><span class="line">db.emps.insert(&#123;&quot;name&quot;:&quot;周十&quot;,&quot;sex&quot;:&quot;男&quot;,&quot;age&quot;:17,&quot;job&quot;:&quot;程序猿&quot;,&quot;salary&quot;:9000&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="group"><a href="#group" class="headerlink" title="$group"></a>$group</h3><p>获取每个职位的人数,总工资,平均工资,最高工资,最低工资</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">db.emps.aggregate(&#123;</span><br><span class="line">	&quot;$group&quot;:&#123;</span><br><span class="line">		&quot;_id&quot;:&quot;$job&quot;,  // 根据&quot;job&quot;字段分组</span><br><span class="line">        &quot;count&quot;:&#123;	   // 人数,使用 $sum,每次+1</span><br><span class="line">            &quot;$sum&quot;:1</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;salary_sum&quot;:&#123; //总工资,每个职位在工资相加</span><br><span class="line">            &quot;$sum&quot;:&quot;$salary&quot; </span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;salary_avg&quot;:&#123;</span><br><span class="line">            &quot;$avg&quot;:&quot;$salary&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;salary_max&quot;:&#123;</span><br><span class="line">            &quot;$max&quot;:&quot;$salary&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;salary_min&quot;:&#123;</span><br><span class="line">            &quot;$min&quot;:&quot;$salary&quot;</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>获取每个职位中员工的姓名,使用 “$push” (如果要消除重复name,可使用”$addToSet”)</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">db.emps.aggregate(&#123;</span><br><span class="line">	&quot;$group&quot;:&#123;</span><br><span class="line">		&quot;_id&quot;:&quot;$job&quot;,</span><br><span class="line">		&quot;names&quot;:&#123;</span><br><span class="line">			&quot;$push&quot;:&quot;$name&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="project"><a href="#project" class="headerlink" title="$project"></a>$project</h3><ul>
<li>数据列的显示规则,投影查询</li>
</ul>
<p>1|true 显示</p>
<p>0|false 不显示</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询emps表,不显示_id,显示name</span></span><br><span class="line">db.emps.aggregate(&#123;</span><br><span class="line">	&quot;$project&quot;:&#123;</span><br><span class="line">		&quot;_id&quot;:0,</span><br><span class="line">		&quot;name&quot;:1</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>起别名</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">db.emps.aggregate(&#123;</span><br><span class="line">	&quot;$project&quot;:&#123;</span><br><span class="line">		&quot;_id&quot;:0,</span><br><span class="line">		&quot;姓名&quot;:&quot;$name&quot;,</span><br><span class="line">		&quot;职位&quot;:&quot;$job&quot;,</span><br><span class="line">		&quot;薪资&quot;:&quot;$salary&quot;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>支持四则运算<ul>
<li>加 $add  </li>
<li>减 $subtract </li>
<li>乘 $multiply</li>
<li>除 $divide </li>
<li>求模 $mod</li>
</ul>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 求年薪</span></span><br><span class="line">db.emps.aggregate(&#123;</span><br><span class="line">	&quot;$project&quot;:&#123;</span><br><span class="line">		&quot;_id&quot;:0,</span><br><span class="line">		&quot;姓名&quot;:&quot;$name&quot;,</span><br><span class="line">		&quot;年薪&quot;:&#123;</span><br><span class="line">			&quot;$multiply&quot;:[&quot;$salary&quot;,12]</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>聚合管道运算符中文文档：<a target="_blank" rel="noopener" href="https://www.docs4dev.com/docs/zh/mongodb/v3.6/reference/reference-operator-aggregation-abs.html">https://www.docs4dev.com/docs/zh/mongodb/v3.6/reference/reference-operator-aggregation-abs.html</a></p>
<h3 id="sort"><a href="#sort" class="headerlink" title="$sort"></a>$sort</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 年龄升序,如果相等,则工资降序</span></span><br><span class="line">db.emps.aggregate(&#123;</span><br><span class="line">	&quot;$sort&quot;:&#123;</span><br><span class="line">		&quot;age&quot;:1,</span><br><span class="line">		&quot;salary&quot;:-1</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 跨3行数据,再取5个</span></span><br><span class="line">db.emps.aggregate(</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="attr">&quot;$project&quot;</span>:&#123;</span><br><span class="line">			<span class="attr">&quot;_id&quot;</span>:<span class="number">0</span>,</span><br><span class="line">			<span class="attr">&quot;name&quot;</span>:<span class="number">1</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="attr">&quot;$skip&quot;</span>:<span class="number">3</span></span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="attr">&quot;$limit&quot;</span>:<span class="number">5</span></span><br><span class="line">	&#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>$skip一定要在$limit前面</p>
<h3 id="out"><a href="#out" class="headerlink" title="$out"></a>$out</h3><p>将投影结果,输出到一个集合中</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">db.emps.aggregate(</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="attr">&quot;$project&quot;</span>:&#123;</span><br><span class="line">			<span class="attr">&quot;_id&quot;</span>:<span class="number">0</span>,</span><br><span class="line">			<span class="attr">&quot;name&quot;</span>:<span class="number">1</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="attr">&quot;$out&quot;</span>:<span class="string">&quot;emps_2&quot;</span>  <span class="comment">// 将结果保存到&quot;emps_2&quot;中</span></span><br><span class="line">	&#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h2 id="固定集合"><a href="#固定集合" class="headerlink" title="固定集合"></a>固定集合</h2><p>规定集合大小，如果保存内容超过了集合的长度，那么会采用 <strong>LRU</strong>的算法，将最早的数据移除，来保存新的数据</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.createCollection(&quot;depts&quot;,&#123;</span><br><span class="line">    &quot;capped&quot;:true,  // true:固定集合</span><br><span class="line">    &quot;size&quot;:1024, // 集合空间容量 1024字节</span><br><span class="line">    &quot;max&quot;:5 // 最多有5条记录</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h1 id="java操作"><a href="#java操作" class="headerlink" title="java操作"></a>java操作</h1><p>这里介绍spring提供对MongoDB操作的工具类的使用</p>
<h2 id="pom"><a href="#pom" class="headerlink" title="pom"></a>pom</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.data<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-data-mongodb<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="spring-xml"><a href="#spring-xml" class="headerlink" title="spring.xml"></a>spring.xml</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line">&lt;beans</span><br><span class="line">       xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">       xmlns:mongo=&quot;http://www.springframework.org/schema/data/mongo&quot;</span><br><span class="line">       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">       xsi:schemaLocation=&quot;</span><br><span class="line">                           http://www.springframework.org/schema/beans</span><br><span class="line">                           http://www.springframework.org/schema/beans/spring-beans.xsd</span><br><span class="line">                           http://www.springframework.org/schema/context</span><br><span class="line">                           http://www.springframework.org/schema/context/spring-context.xsd</span><br><span class="line">                           http://www.springframework.org/schema/data/mongo</span><br><span class="line">                           http://www.springframework.org/schema/data/mongo/spring-mongo.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!--包扫描--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.hui&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">    <span class="tag">&lt;<span class="name">mongo:db-factory</span> <span class="attr">id</span>=<span class="string">&quot;mongoDbFactory&quot;</span> <span class="attr">client-uri</span>=<span class="string">&quot;mongodb://212.129.221.154:27017/test&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;mongoTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.data.mongodb.core.MongoTemplate&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;mongoDbFactory&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;mongoDbFactory&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="实体类-操作emps集合"><a href="#实体类-操作emps集合" class="headerlink" title="实体类(操作emps集合)"></a>实体类(操作emps集合)</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hui.entity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.core.mapping.Document;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Document(collection = &quot;emps&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Emp</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String _id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> age;</span><br><span class="line">    <span class="keyword">private</span> String job;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> salary;</span><br><span class="line">    <span class="comment">// getter setter 省略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="MongoTemplate常用方法"><a href="#MongoTemplate常用方法" class="headerlink" title="MongoTemplate常用方法"></a>MongoTemplate常用方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mongoTemplate.findAll(Student.class) &#x2F;&#x2F; 查询Student文档的全部数据</span><br><span class="line">mongoTemplate.findById(&lt;id&gt;, Student.class) &#x2F;&#x2F; 查询Student文档id为id的数据</span><br><span class="line">mongoTemplate.find(query, Student.class) &#x2F;&#x2F; 根据query内的查询条件查询</span><br><span class="line">mongoTemplate.upsert(query, update, Student.class) &#x2F;&#x2F; 修改</span><br><span class="line">mongoTemplate.remove(query, Student.class) &#x2F;&#x2F; 删除</span><br><span class="line">mongoTemplate.insert(student) &#x2F;&#x2F; 新增</span><br></pre></td></tr></table></figure>
<ul>
<li><p>Query对象</p>
<ul>
<li>封装所有条件对象,可通过构造方法传条件<code>new Query(Criteria)</code>或<code>query.addCriteria(criteria)</code></li>
</ul>
</li>
<li><p>Criteria对象</p>
<ul>
<li>用来构建条件,可直接<code>new Criteria()</code>,也可使用 <code>Criteria.where(&quot;key&quot;)</code> 创建</li>
<li>精准条件: criteria.and(“key”).is(“条件”)</li>
<li>模糊条件: criteria.and(“key”).regex(“条件”)</li>
<li>大于: criteria.and(“key”).gt(“条件”)</li>
<li>小于: criteria.and(“key”).lt(“条件”)</li>
</ul>
</li>
</ul>
<h2 id="接口及实现类"><a href="#接口及实现类" class="headerlink" title="接口及实现类"></a>接口及实现类</h2><ul>
<li>接口</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmpService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(Emp emp)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">delete</span><span class="params">(String id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(Emp emp)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Emp <span class="title">findById</span><span class="params">(String id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Long <span class="title">findCount</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 模糊查询</span></span><br><span class="line">    <span class="function">List&lt;Emp&gt; <span class="title">findList</span><span class="params">(Integer pageNum, Integer pageSize, String name)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>实现类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;empService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmpServiceImpl</span> <span class="keyword">implements</span> <span class="title">EmpService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MongoTemplate mongoTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(Emp emp)</span> </span>&#123;</span><br><span class="line">        mongoTemplate.insert(emp);</span><br><span class="line">        System.out.println(<span class="string">&quot;增加成功！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        Query query = <span class="keyword">new</span> Query(Criteria.where(<span class="string">&quot;_id&quot;</span>).is(id));</span><br><span class="line">        DeleteResult remove = mongoTemplate.remove(query, Emp.class);</span><br><span class="line">        <span class="keyword">if</span> (remove.getDeletedCount() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;删除成功&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Emp emp)</span> </span>&#123;</span><br><span class="line">        Query query = <span class="keyword">new</span> Query();</span><br><span class="line">        query.addCriteria(Criteria.where(<span class="string">&quot;_id&quot;</span>).is(emp.get_id()));</span><br><span class="line"></span><br><span class="line">        Update update = <span class="keyword">new</span> Update();</span><br><span class="line">        update.set(<span class="string">&quot;name&quot;</span>, emp.getName());</span><br><span class="line">        update.set(<span class="string">&quot;sex&quot;</span>, emp.getSex());</span><br><span class="line">        update.set(<span class="string">&quot;age&quot;</span>, emp.getAge());</span><br><span class="line">        update.set(<span class="string">&quot;job&quot;</span>, emp.getJob());</span><br><span class="line">        update.set(<span class="string">&quot;salary&quot;</span>, emp.getSalary());</span><br><span class="line"></span><br><span class="line">        UpdateResult upsert = mongoTemplate.upsert(query, update, Emp.class);</span><br><span class="line">        <span class="keyword">if</span> (upsert.getModifiedCount() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;修改成功&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Emp <span class="title">findById</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        Emp emp = mongoTemplate.findById(id, Emp.class);</span><br><span class="line">        <span class="keyword">return</span> emp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">findCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Query query = <span class="keyword">new</span> Query();</span><br><span class="line">        <span class="keyword">long</span> count = mongoTemplate.count(query, Emp.class);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 模糊+分页查询</span></span><br><span class="line">    <span class="comment">// 模糊查询以【^】开始,以【$】结束,【.*】相当于Mysql中的%</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Emp&gt; <span class="title">findList</span><span class="params">(Integer pageNum, Integer pageSize, String name)</span> </span>&#123;</span><br><span class="line">        Query query = <span class="keyword">new</span> Query();</span><br><span class="line">        <span class="comment">// 不为空就模糊查询</span></span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(name)) &#123;</span><br><span class="line">            String regex = <span class="string">&quot;^.*&quot;</span> + name + <span class="string">&quot;.*$&quot;</span>;</span><br><span class="line">            <span class="comment">// 构建正则对象, Pattern.CASE_INSENSITIVE表示忽略大小写</span></span><br><span class="line">            Pattern pattern = Pattern.compile(regex, Pattern.CASE_INSENSITIVE);</span><br><span class="line">            query.addCriteria(Criteria.where(<span class="string">&quot;name&quot;</span>).regex(pattern));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 分页</span></span><br><span class="line">        List&lt;Emp&gt; emps = mongoTemplate.find(query.skip((pageNum - <span class="number">1</span>) * pageSize).limit(pageSize), Emp.class);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> emps;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ClassPathXmlApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;spring.xml&quot;</span>);</span><br><span class="line">        EmpService empService = context.getBean(<span class="string">&quot;empService&quot;</span>, EmpService.class);</span><br><span class="line">        <span class="comment">// 增</span></span><br><span class="line"><span class="comment">//        empService.insert(new Emp(&quot;2&quot;,&quot;2&quot;,2,&quot;2&quot;,2));</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 删</span></span><br><span class="line"><span class="comment">//        empService.delete(&quot;61e26329a13ff02ed43c5b4f&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 改</span></span><br><span class="line"><span class="comment">//        empService.update(new Emp(&quot;61e26506a13ff02ac8e05955&quot;,&quot;怪狗狗&quot;,&quot;男&quot;,22,&quot;man&quot;,2000));</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//根据id查询</span></span><br><span class="line"><span class="comment">//        Emp byId = empService.findById(&quot;61e26506a13ff02ac8e05955&quot;);</span></span><br><span class="line"><span class="comment">//        System.out.println(byId);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 查询数量</span></span><br><span class="line"><span class="comment">//        Long count = empService.findCount();</span></span><br><span class="line"><span class="comment">//        System.out.println(count);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 模糊查询</span></span><br><span class="line">        List&lt;Emp&gt; list = empService.findList(<span class="number">1</span>, <span class="number">5</span>, <span class="string">&quot;怪&quot;</span>);</span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>over…</p>

    </div>

    
    
    
        <div class="reward-container">
  <div>感谢老铁们的支持!!!</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/weChatPay.png" alt="怪狗狗 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/aliPay.jpg" alt="怪狗狗 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/noSQL/" rel="tag"> noSQL</a>
              <a href="/tags/mongoDB/" rel="tag"> mongoDB</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/11/20/concurrent/" rel="prev" title="concurrent">
      <i class="fa fa-chevron-left"></i> concurrent
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/02/24/SpringSecurity/" rel="next" title="SpringSecurity">
      SpringSecurity <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="nav-number">1.</span> <span class="nav-text">安装与配置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-number">2.</span> <span class="nav-text">基本操作</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8F%92%E5%85%A5"><span class="nav-number">2.1.</span> <span class="nav-text">插入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%A0%E9%99%A4"><span class="nav-number">2.2.</span> <span class="nav-text">删除</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9"><span class="nav-number">2.3.</span> <span class="nav-text">修改</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0"><span class="nav-number">2.3.1.</span> <span class="nav-text">函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E5%99%A8"><span class="nav-number">2.3.2.</span> <span class="nav-text">修改器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2"><span class="nav-number">2.4.</span> <span class="nav-text">查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E7%B3%BB%E8%BF%90%E7%AE%97"><span class="nav-number">2.4.1.</span> <span class="nav-text">关系运算</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97"><span class="nav-number">2.4.2.</span> <span class="nav-text">逻辑运算</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B1%82%E6%A8%A1"><span class="nav-number">2.4.3.</span> <span class="nav-text">求模</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8C%83%E5%9B%B4"><span class="nav-number">2.4.4.</span> <span class="nav-text">范围</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E7%BB%84%E6%9F%A5%E8%AF%A2"><span class="nav-number">2.4.5.</span> <span class="nav-text">数组查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B5%8C%E5%A5%97%E9%9B%86%E5%90%88"><span class="nav-number">2.4.6.</span> <span class="nav-text">嵌套集合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E6%AE%B5%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8"><span class="nav-number">2.4.7.</span> <span class="nav-text">字段是否存在</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2"><span class="nav-number">2.4.8.</span> <span class="nav-text">模糊查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E9%A1%B5%E4%B8%8E%E6%8E%92%E5%BA%8F"><span class="nav-number">2.4.9.</span> <span class="nav-text">分页与排序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6%E8%BF%87%E6%BB%A4where"><span class="nav-number">2.4.10.</span> <span class="nav-text">条件过滤where</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B8%B8%E6%A0%87"><span class="nav-number">2.5.</span> <span class="nav-text">游标</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95"><span class="nav-number">3.</span> <span class="nav-text">索引</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95"><span class="nav-number">3.1.</span> <span class="nav-text">唯一索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%87%E6%9C%9F%E7%B4%A2%E5%BC%95"><span class="nav-number">3.2.</span> <span class="nav-text">过期索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%A8%E6%96%87%E7%B4%A2%E5%BC%95"><span class="nav-number">3.3.</span> <span class="nav-text">全文索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%B0%E7%90%86%E4%BF%A1%E6%81%AF%E7%B4%A2%E5%BC%95"><span class="nav-number">3.4.</span> <span class="nav-text">地理信息索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E9%99%90%E5%88%B6"><span class="nav-number">3.5.</span> <span class="nav-text">索引的限制</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%81%9A%E5%90%88"><span class="nav-number">4.</span> <span class="nav-text">聚合</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E9%87%8F"><span class="nav-number">4.1.</span> <span class="nav-text">数据量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B6%88%E9%99%A4%E9%87%8D%E5%A4%8D%E6%95%B0%E6%8D%AE"><span class="nav-number">4.2.</span> <span class="nav-text">消除重复数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%81%9A%E5%90%88%E6%A1%86%E6%9E%B6"><span class="nav-number">4.3.</span> <span class="nav-text">聚合框架</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#group"><span class="nav-number">4.3.1.</span> <span class="nav-text">$group</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#project"><span class="nav-number">4.3.2.</span> <span class="nav-text">$project</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sort"><span class="nav-number">4.3.3.</span> <span class="nav-text">$sort</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E9%A1%B5"><span class="nav-number">4.3.4.</span> <span class="nav-text">分页</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#out"><span class="nav-number">4.3.5.</span> <span class="nav-text">$out</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%BA%E5%AE%9A%E9%9B%86%E5%90%88"><span class="nav-number">4.4.</span> <span class="nav-text">固定集合</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#java%E6%93%8D%E4%BD%9C"><span class="nav-number">5.</span> <span class="nav-text">java操作</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#pom"><span class="nav-number">5.1.</span> <span class="nav-text">pom</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#spring-xml"><span class="nav-number">5.2.</span> <span class="nav-text">spring.xml</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E4%BD%93%E7%B1%BB-%E6%93%8D%E4%BD%9Cemps%E9%9B%86%E5%90%88"><span class="nav-number">5.3.</span> <span class="nav-text">实体类(操作emps集合)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MongoTemplate%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95"><span class="nav-number">5.4.</span> <span class="nav-text">MongoTemplate常用方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%A5%E5%8F%A3%E5%8F%8A%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="nav-number">5.5.</span> <span class="nav-text">接口及实现类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95"><span class="nav-number">5.6.</span> <span class="nav-text">测试</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="怪狗狗"
      src="/images/jerry.jpg">
  <p class="site-author-name" itemprop="name">怪狗狗</p>
  <div class="site-description" itemprop="description">跑得又快，长得又帅</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">46</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">74</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/oddDog-git" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;oddDog-git" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://1764501567@qq.com/" title="E-Mail → https:&#x2F;&#x2F;1764501567@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://wpa.qq.com/msgrd?v=3&uin=1764501567&site=qq&menu=yes" title="http:&#x2F;&#x2F;wpa.qq.com&#x2F;msgrd?v&#x3D;3&amp;uin&#x3D;1764501567&amp;site&#x3D;qq&amp;menu&#x3D;yes" rel="noopener" target="_blank">加我QQ</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">怪狗狗</span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div> -->

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/canvas_lines.min.js"></script>


  















  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'YVPmrsyUdC4uV9bapDgb8ll6-gzGzoHsz',
      appKey     : 'MUI57EQtRoMQjLvpW68kiNyE',
      placeholder: "快来评论吧！！！",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
